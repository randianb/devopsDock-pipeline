- name: Replace mail server settings block in config.py
  replace:
    path: /usr/pgadmin4/web/config.py
    regexp: |
      MAIL_SERVER\s*=\s*'[^']*'\s*\nMAIL_PORT\s*=\s*\d+\s*\nMAIL_USE_SSL\s*=\s*(True|False)\s*\nMAIL_USE_TLS\s*=\s*(True|False)\s*\nMAIL_USERNAME\s*=\s*'[^']*'\s*\nMAIL_PASSWORD\s*=\s*'[^']*'\s*\nMAIL_DEBUG\s*=\s*(True|False)\s*\n\n# Flask-Security overrides Flask-Mail's MAIL_DEFAULT_SENDER setting, so\n# that should be set as such:\nSECURITY_EMAIL_SENDER\s*=\s*'[^']*'
    replace: |
      MAIL_SERVER = 'smtp.example.com'
      MAIL_PORT = 587
      MAIL_USE_SSL = False
      MAIL_USE_TLS = True
      MAIL_USERNAME = 'your-email@example.com'
      MAIL_PASSWORD = 'your-email-password'
      MAIL_DEBUG = False

      # Flask-Security overrides Flask-Mail's MAIL_DEFAULT_SENDER setting, so
      # that should be set as such:
      SECURITY_EMAIL_SENDER = 'no-reply@example.com'