make this function more dynamic to errors handling and also to hanlde the cases where the some itteration failed to retry until the respone is 200 then continue to get the full result : 
    def get_image_details(self, image_data, region, retry=3):
        access_token = self.get_iam_token(["ccs:read"])
        
        servers_images = {}  # Mapping: server_name -> image_name

        for entry in image_data:
            for server_name, image_id in entry.items():
                endpoint = OCS_SERVER_IMAGE_ENDPOINT.replace("#region#", region)
                url = f"{endpoint}/{image_id}"

                res = http_client.get(
                    url,
                    headers={
                        "accept": "application/json",
                        "Authorization": f"Bearer {access_token}"
                    }
                )

                if res.status_code != 200 and retry > 0:
                    time.sleep(2)
                    return self.get_image_details([entry], region, retry - 1)

                if res.status_code != 200:
                    logger.error(f"Failed to retrieve image details: {res.text}")
                    continue

                data = res.json()
                if "image" not in data:
                    logger.error("No image details found")
                    continue

                image_name = data["image"]["name"]
                servers_images[server_name] = image_name

        return servers_images
