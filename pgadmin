- name: Configure pgAdmin to use external PostgreSQL
  become: true
  template:
    src: config_local.py.j2
    dest: /etc/pgadmin4/config_local.py
    owner: root
    group: root
    mode: '0644'
    force: yes
  notify: Restart Apache HTTPD

- name: Execute setup-web script
  become: true
  shell: |
    /usr/pgadmin4/bin/setup-web.sh
  args:
    creates: /var/lib/pgadmin/pgadmin4.db
  environment:
    PGADMIN_SETUP_EMAIL: "{{ pgadmin_setup_email }}"
    PGADMIN_SETUP_PASSWORD: "{{ pgadmin_setup_password }}"
  ignore_errors: true
  
