import sys
from common import logger, sgcloud
import os
from contextlib import redirect_stdout

def get_latest_os_image(region="paris"):
    sg_cloud_client = sgcloud.Client(os.environ['ACCOUNT_ID'], os.environ['CLIENT_ID'], os.environ['CLIENT_SECRET'])
    
    # Redirect stdout to /dev/null to suppress unwanted output
    with open(os.devnull, 'w') as devnull:
        with redirect_stdout(devnull):
            # Get the list of images
            list_of_images = sg_cloud_client.get_images(region=region)
            
            # Get the latest image
            latest_image = sg_cloud_client.get_latest_image(region=region)
    
    # Print the list of images and the latest image
    print(f"List of images exists on OS Factory in the region {region}: {list_of_images}")
    print(f"Latest image in the {region} region: {latest_image}")


def main():
    region = sys.argv[1]
    regions = region.split(",") if "," in region else [region]

    for region in regions:
        get_latest_os_image(region.strip())  # Get and print the list of images and the latest image


if __name__ == "__main__":
    main()