#!/bin/bash

# SMTP Configuration
SMTP_HOST="smtp-goss.int.world.socgen"
SMTP_PORT=25
MAIL_FROM="devops.monitoring@socgen.com"
MAIL_TO="anouar.harrou@socgen.com"

# Fetch server details
latest_paris="$1"
latest_north="$2"
account="$3"

# Function to send an email notification
send_email() {
    local subject="ğŸš¨ Image Mismatch Alert - Region Discrepancy Detected"
    local message="<html>
    <body style='font-family:Arial, sans-serif;'>
        <h2 style='color:#d9534f;'>ğŸš¨ Alert: Image Mismatch Detected</h2>
        <p style='font-size:14px;'>An inconsistency has been detected in the latest images deployed in different regions.</p>
        <hr>
        <h3 style='color:#0275d8;'>ğŸ”¹ Account: <span style='color:#5cb85c;'>${account}</span></h3>
        <p style='font-size:16px;'>âš ï¸ The latest image versions are not aligned:</p>
        <ul>
            <li>ğŸ“ <b>Paris:</b> <span style='color:#d9534f;'>${latest_paris}</span></li>
            <li>ğŸ“ <b>North:</b> <span style='color:#d9534f;'>${latest_north}</span></li>
        </ul>
        <p>ğŸ” Please investigate the discrepancy and take necessary actions.</p>
        <hr>
        <p style='color:#5e5e5e; font-size:12px;'>ğŸ“§ This is an automated notification from the DevOps monitoring system.</p>
    </body></html>"
    
    local temp_file=$(mktemp)

    echo -e "Subject: ${subject}\nContent-Type: text/html; charset=UTF-8\n\n${message}" > "${temp_file}"

    curl -s --url "smtp://${SMTP_HOST}:${SMTP_PORT}" --mail-from "${MAIL_FROM}" --mail-rcpt "${MAIL_TO}" --upload-file "${temp_file}"

    rm -f "${temp_file}"
}

# Execute the email function
send_email




=======

#!/bin/bash

# SMTP Configuration
SMTP_HOST="smtp-goss.int.world.socgen"
SMTP_PORT=25
MAIL_FROM="devops.monitoring@socgen.com"
MAIL_TO="anouar.harrou@socgen.com"

# Read server details
server_name="$1"
account="$2"
mismatch_details="$3"

# Function to send an email notification
send_email() {
    local subject="âš ï¸ Image Mismatch Alert - Server: ${server_name} (Account: ${account})"
    local message="<html>
    <body style='font-family:Arial, sans-serif;'>
        <h2 style='color:#d9534f;'>âš ï¸ Image Mismatch Detected on ${server_name}</h2>
        <p style='font-size:14px;'>A discrepancy has been identified in the image versions on the specified server.</p>
        <hr>
        <h3 style='color:#0275d8;'>ğŸ”¹ Account: <span style='color:#5cb85c;'>${account}</span></h3>
        <h3 style='color:#0275d8;'>ğŸ”¹ Server: <span style='color:#5cb85c;'>${server_name}</span></h3>
        <p>ğŸ“Œ <b>Mismatch Details:</b></p>
        <pre style='background:#f8f9fa; padding:10px; border-left:4px solid #d9534f;'>${mismatch_details}</pre>
        <p>ğŸ” Please review the details and take appropriate actions.</p>
        <hr>
        <p style='color:#5e5e5e; font-size:12px;'>ğŸ“§ This is an automated notification from the DevOps monitoring system.</p>
    </body></html>"

    local temp_file=$(mktemp)

    echo -e "Subject: ${subject}\nContent-Type: text/html; charset=UTF-8\n\n${message}" > "${temp_file}"

    curl -s --url "smtp://${SMTP_HOST}:${SMTP_PORT}" --mail-from "${MAIL_FROM}" --mail-rcpt "${MAIL_TO}" --upload-file "${temp_file}"

    rm -f "${temp_file}"
}

# Execute the email function
send_email